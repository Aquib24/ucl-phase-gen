<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCL ¬∑ League Phase Manager</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="hero">
            <h1>
                <span>‚öΩ</span> UCL League Phase ¬∑ Manager
            </h1>
            <div class="badge" id="globalStateBadge">
                üíæ Storage ready
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- CARD 1: Team Manager -->
            <div class="card">
                <div class="card-header">
                    <h2><span>üìã</span> Team Manager</h2>
                    <span id="teamCountBadge">0</span>
                </div>
                <div class="card-content">
                    <div class="flex-row">
                        <button class="btn" id="sampleTeamsBtn">üè≠ Generate 36 teams</button>
                        <label class="btn" for="teamsCSVUpload">üìé Teams CSV</label>
                        <input type="file" id="teamsCSVUpload" accept=".csv" style="display: none;">
                        <label class="btn" for="playersCSVUpload">üìé Players CSV</label>
                        <input type="file" id="playersCSVUpload" accept=".csv" style="display: none;">
                    </div>
                    <div class="team-cloud" id="teamCloudContainer"></div>
                    <button class="btn btn-primary" id="loadDataBtn" style="width:100%; margin-top:1rem;">üöÄ Load competition data</button>
                    <div id="dataPipelineStatus" class="status-text"></div>
                </div>
            </div>

            <!-- CARD 2: Draw Engine -->
            <div class="card">
                <div class="card-header">
                    <h2><span>üéØ</span> Draw & Schedule</h2>
                    <span id="matchCountBadge">0</span>
                </div>
                <div class="card-content">
                    <div class="flex-row">
                        <button class="btn btn-primary" id="drawBtn">‚ö° Run constraint draw</button>
                        <button class="btn" id="validateDrawBtn">üîç Validate</button>
                    </div>
                    <div id="drawFeedback" class="feedback-box"></div>
                    <hr>
                    <div><strong>üìÖ Matchdays</strong></div>
                    <div class="matchday-tabs" id="matchdayTabBar"></div>
                </div>
            </div>

            <!-- CARD 3: Matchday Viewer -->
            <div class="card grid-span-2">
                <div class="card-header">
                    <h2><span>üìÖ</span> Matchday viewer</h2>
                    <span id="currentMDLabel">MD1</span>
                </div>
                <div class="card-content">
                    <div id="matchdayMatchList" class="match-list"></div>
                </div>
            </div>

            <!-- CARD 4: Match Editor with SEARCH -->
            <div class="card">
                <div class="card-header">
                    <h2><span>‚öôÔ∏è</span> Match Search & Editor</h2>
                </div>
                <div class="card-content">
                    <!-- SEARCH SECTION -->
                    <div class="search-section">
                        <div class="search-row">
                            <div class="search-input-wrapper">
                                <input 
                                    type="text" 
                                    id="searchInput" 
                                    placeholder="üîç Search by team name..." 
                                >
                            </div>
                            <select id="matchdaySearchFilter">
                                <option value="0">All MD</option>
                                <option value="1">MD1</option>
                                <option value="2">MD2</option>
                                <option value="3">MD3</option>
                                <option value="4">MD4</option>
                                <option value="5">MD5</option>
                                <option value="6">MD6</option>
                                <option value="7">MD7</option>
                                <option value="8">MD8</option>
                            </select>
                            <button id="searchBtn" class="btn btn-primary">üîç Search</button>
                        </div>
                        
                        <div class="filter-row">
                            <select id="teamSearchFilter">
                                <option value="0">All Teams</option>
                            </select>
                            <select id="statusSearchFilter">
                                <option value="all">All Matches</option>
                                <option value="unplayed">Not Played</option>
                                <option value="played">Played</option>
                            </select>
                            <button id="resetSearchBtn" class="btn">Reset</button>
                        </div>
                    </div>

                    <!-- SEARCH RESULTS -->
                    <div class="results-section">
                        <div class="results-header">
                            <h3>Search Results <span id="resultCount">(0)</span></h3>
                            <button id="refreshResultsBtn" class="btn btn-sm">‚Üª</button>
                        </div>
                        <div id="searchResultsList" class="results-list"></div>
                    </div>

                    <!-- MATCH EDITOR - FIXED VERSION -->
                    <div id="matchEditPanel" class="editor-panel" style="display: none;">
                        <h3>‚öΩ Edit Match</h3>
                        
                        <!-- Score Section -->
                        <div class="form-row">
                            <span id="matchHomeName" class="team-badge"></span>
                            <input type="number" id="homeScore" min="0" class="small-input" value="0">
                            <span style="font-weight:700; color:var(--primary-600);">:</span>
                            <input type="number" id="awayScore" min="0" class="small-input" value="0">
                            <span id="matchAwayName" class="team-badge"></span>
                        </div>
                        
                        <hr>
                        
                        <!-- Add Goal Section -->
                        <div class="goal-section">‚öΩ Add Goal</div>
                        
                        <select id="scorerSelect" class="full-width">
                            <option value="">Select scorer...</option>
                        </select>
                        
                        <select id="assisterSelect" class="full-width">
                            <option value="">‚Äî no assist ‚Äî</option>
                        </select>
                        
                        <div class="minute-row">
                            <input type="number" id="minuteInput" placeholder="min" min="1" max="120" value="45">
                            <button class="btn btn-sm" id="addGoalEventBtn">‚ûï Add Goal</button>
                        </div>
                        
                        <!-- Events List (scrollable) -->
                        <div id="eventsList" class="events-list"></div>
                        
                        <hr>
                        
                        <!-- MOTM Section -->
                        <div class="motm-section">üèÜ Man of the Match</div>
                        <select id="motmSelect" class="full-width">
                            <option value="">‚Äî select MOTM ‚Äî</option>
                        </select>
                        
                        <!-- Save Button - Always Visible -->
                        <button class="btn btn-primary" id="saveMatchBtn">üíæ SAVE MATCH RESULT</button>
                        <div id="editorError" class="error-msg" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- CARD 5: League Table -->
            <div class="card">
                <div class="card-header">
                    <h2><span>üèÜ</span> League table</h2>
                </div>
                <div class="card-content">
                    <div class="table-responsive" id="leagueTableContainer"></div>
                </div>
            </div>

            <!-- CARD 6: Top scorers -->
            <div class="card">
                <div class="card-header">
                    <h2><span>‚öΩ</span> Top scorers</h2>
                </div>
                <div class="card-content">
                    <div id="scorersList" class="leaderboard"></div>
                </div>
            </div>

            <!-- CARD 7: Top assists -->
            <div class="card">
                <div class="card-header">
                    <h2><span>üÖ∞Ô∏è</span> Top assists</h2>
                </div>
                <div class="card-content">
                    <div id="assistsList" class="leaderboard"></div>
                </div>
            </div>

            <!-- CARD 8: Most MOTM -->
            <div class="card">
                <div class="card-header">
                    <h2><span>‚≠ê</span> Most MOTM</h2>
                </div>
                <div class="card-content">
                    <div id="motmList" class="leaderboard"></div>
                </div>
            </div>

            <!-- CARD 9: Export/Import -->
            <div class="card grid-span-4">
                <div class="card-header">
                    <h2><span>üíæ</span> Storage</h2>
                </div>
                <div class="card-content">
                    <div class="status-banner">
                        <span><strong>Auto-save enabled</strong> ¬∑ localStorage</span>
                        <div class="action-buttons">
                            <button class="btn" id="exportBtn">üì§ Export</button>
                            <label class="btn" for="importFile">üì• Import</label>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                            <button class="btn" id="resetBtn">üîÑ Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Expand/Collapse All Button -->
    <div class="global-controls">
        <button class="btn btn-sm" id="expandAllBtn">üîç Expand All</button>
        <button class="btn btn-sm" id="collapseAllBtn">üìå Collapse All</button>
    </div>

    <script src="dataStore.js"></script>
    <script src="csvParser.js"></script>
    <script src="storage.js"></script>
    <script src="drawEngine.js"></script>
    <script src="matchEngine.js"></script>
    <script src="statsEngine.js"></script>
    <script src="uiRenderer.js"></script>
    <script src="app.js"></script>
</body>
</html>