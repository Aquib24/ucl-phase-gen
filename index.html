<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCL Â· League Phase Manager</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="hero">
            <h1>
                <span>âš½</span> UCL League Phase Â· Manager
            </h1>
            <div class="badge" id="globalStateBadge">
                ğŸ’¾ Storage ready
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- CARD 1: Team Manager -->
            <div class="card collapsible" data-card="teamManager">
                <div class="card-header clickable-header">
                    <h2><span>ğŸ“‹</span> Team Manager</h2>
                    <div class="card-controls">
                        <span id="teamCountBadge">0</span>
                        <button class="collapse-btn">âˆ’</button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="flex-row">
                        <button class="btn" id="sampleTeamsBtn">ğŸ­ Generate 36 teams</button>
                        <label class="btn" for="teamsCSVUpload">ğŸ“ Teams CSV</label>
                        <input type="file" id="teamsCSVUpload" accept=".csv" style="display: none;">
                        <label class="btn" for="playersCSVUpload">ğŸ“ Players CSV</label>
                        <input type="file" id="playersCSVUpload" accept=".csv" style="display: none;">
                    </div>
                    <div class="team-cloud" id="teamCloudContainer"></div>
                    <button class="btn btn-primary" id="loadDataBtn" style="width:100%; margin-top:1rem;">ğŸš€ Load competition data</button>
                    <div id="dataPipelineStatus" class="status-text"></div>
                </div>
            </div>

            <!-- CARD 2: Draw Engine -->
            <div class="card collapsible" data-card="drawEngine">
                <div class="card-header clickable-header">
                    <h2><span>ğŸ¯</span> Draw & Schedule</h2>
                    <div class="card-controls">
                        <span id="matchCountBadge">0</span>
                        <button class="collapse-btn">âˆ’</button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="flex-row">
                        <button class="btn btn-primary" id="drawBtn">âš¡ Run constraint draw</button>
                        <button class="btn" id="validateDrawBtn">ğŸ” Validate</button>
                    </div>
                    <div id="drawFeedback" class="feedback-box"></div>
                    <hr>
                    <div><strong>ğŸ“… Matchdays</strong></div>
                    <div class="matchday-tabs" id="matchdayTabBar"></div>
                </div>
            </div>

            <!-- CARD 3: Matchday Viewer -->
            <div class="card grid-span-2 collapsible" data-card="matchdayViewer">
                <div class="card-header clickable-header">
                    <h2><span>ğŸ“…</span> Matchday viewer</h2>
                    <div class="card-controls">
                        <span id="currentMDLabel">MD1</span>
                        <button class="collapse-btn">âˆ’</button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="matchdayMatchList" class="match-list"></div>
                </div>
            </div>

            <!-- CARD 4: Match Editor with SEARCH -->
            <div class="card collapsible" data-card="matchEditor">
                <div class="card-header clickable-header">
                    <h2><span>âš™ï¸</span> Match Search & Editor</h2>
                    <button class="collapse-btn">âˆ’</button>
                </div>
                <div class="card-content">
                    <!-- SEARCH SECTION -->
                    <div class="search-section">
                        <div class="search-row">
                            <div class="search-input-wrapper">
                                <input 
                                    type="text" 
                                    id="searchInput" 
                                    placeholder="ğŸ” Search by team name..." 
                                >
                            </div>
                            <select id="matchdaySearchFilter">
                                <option value="0">All MD</option>
                                <option value="1">MD1</option>
                                <option value="2">MD2</option>
                                <option value="3">MD3</option>
                                <option value="4">MD4</option>
                                <option value="5">MD5</option>
                                <option value="6">MD6</option>
                                <option value="7">MD7</option>
                                <option value="8">MD8</option>
                            </select>
                            <button id="searchBtn" class="btn btn-primary">ğŸ” Search</button>
                        </div>
                        
                        <div class="filter-row">
                            <select id="teamSearchFilter">
                                <option value="0">All Teams</option>
                            </select>
                            <select id="statusSearchFilter">
                                <option value="all">All Matches</option>
                                <option value="unplayed">Not Played</option>
                                <option value="played">Played</option>
                            </select>
                            <button id="resetSearchBtn" class="btn">Reset</button>
                        </div>
                    </div>

                    <!-- SEARCH RESULTS -->
                    <div class="results-section">
                        <div class="results-header">
                            <h3>Search Results <span id="resultCount">(0)</span></h3>
                            <button id="refreshResultsBtn" class="btn btn-sm">â†»</button>
                        </div>
                        <div id="searchResultsList" class="results-list"></div>
                    </div>

                    <!-- MATCH EDITOR -->
                    <div id="matchEditPanel" class="editor-panel" style="display: none;">
                        <hr>
                        <h3>Edit Match</h3>
                        <div class="form-row">
                            <span id="matchHomeName" class="team-badge"></span>
                            <input type="number" id="homeScore" min="0" class="small-input" value="0">
                            <span>:</span>
                            <input type="number" id="awayScore" min="0" class="small-input" value="0">
                            <span id="matchAwayName" class="team-badge"></span>
                        </div>
                        
                        <div class="goal-section">
                            <strong>âš½ Add goal</strong>
                        </div>
                        <select id="scorerSelect" class="full-width"></select>
                        <select id="assisterSelect" class="full-width">
                            <option value="">â€” no assist â€”</option>
                        </select>
                        <div class="form-row">
                            <input type="number" id="minuteInput" placeholder="min" min="1" max="120" style="width:80px;">
                            <button class="btn btn-sm" id="addGoalEventBtn">â• Add</button>
                        </div>
                        
                        <div id="eventsList" class="events-list"></div>
                        
                        <div class="motm-section">
                            <strong>ğŸ† MOTM</strong>
                        </div>
                        <select id="motmSelect" class="full-width"></select>
                        
                        <button class="btn btn-primary" id="saveMatchBtn">ğŸ’¾ Save Match</button>
                        <div id="editorError" class="error-msg" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- CARD 5: League Table -->
            <div class="card collapsible" data-card="leagueTable">
                <div class="card-header clickable-header">
                    <h2><span>ğŸ†</span> League table</h2>
                    <button class="collapse-btn">âˆ’</button>
                </div>
                <div class="card-content">
                    <div class="table-responsive" id="leagueTableContainer"></div>
                </div>
            </div>

            <!-- CARD 6: Top scorers -->
            <div class="card collapsible" data-card="topScorers">
                <div class="card-header clickable-header">
                    <h2><span>âš½</span> Top scorers</h2>
                    <button class="collapse-btn">âˆ’</button>
                </div>
                <div class="card-content">
                    <div id="scorersList" class="leaderboard"></div>
                </div>
            </div>

            <!-- CARD 7: Top assists -->
            <div class="card collapsible" data-card="topAssists">
                <div class="card-header clickable-header">
                    <h2><span>ğŸ…°ï¸</span> Top assists</h2>
                    <button class="collapse-btn">âˆ’</button>
                </div>
                <div class="card-content">
                    <div id="assistsList" class="leaderboard"></div>
                </div>
            </div>

            <!-- CARD 8: Most MOTM -->
            <div class="card collapsible" data-card="topMotm">
                <div class="card-header clickable-header">
                    <h2><span>â­</span> Most MOTM</h2>
                    <button class="collapse-btn">âˆ’</button>
                </div>
                <div class="card-content">
                    <div id="motmList" class="leaderboard"></div>
                </div>
            </div>

            <!-- CARD 9: Export/Import -->
            <div class="card grid-span-4 collapsible" data-card="exportImport">
                <div class="card-header clickable-header">
                    <h2><span>ğŸ’¾</span> Storage</h2>
                    <button class="collapse-btn">âˆ’</button>
                </div>
                <div class="card-content">
                    <div class="status-banner">
                        <span><strong>Auto-save enabled</strong> Â· localStorage</span>
                        <div class="action-buttons">
                            <button class="btn" id="exportBtn">ğŸ“¤ Export</button>
                            <label class="btn" for="importFile">ğŸ“¥ Import</label>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                            <button class="btn" id="resetBtn">ğŸ”„ Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Expand/Collapse All Button -->
    <div class="global-controls">
        <button class="btn btn-sm" id="expandAllBtn">ğŸ” Expand All</button>
        <button class="btn btn-sm" id="collapseAllBtn">ğŸ“Œ Collapse All</button>
    </div>

    <script src="dataStore.js"></script>
    <script src="csvParser.js"></script>
    <script src="storage.js"></script>
    <script src="drawEngine.js"></script>
    <script src="matchEngine.js"></script>
    <script src="statsEngine.js"></script>
    <script src="uiRenderer.js"></script>
    <script src="app.js"></script>
    
    <!-- Collapsible Cards Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize collapsible cards
            const cards = document.querySelectorAll('.collapsible');
            
            cards.forEach(card => {
                const header = card.querySelector('.card-header');
                const content = card.querySelector('.card-content');
                const collapseBtn = card.querySelector('.collapse-btn');
                
                if (header && content && collapseBtn) {
                    header.addEventListener('click', (e) => {
                        // Don't collapse if clicking on buttons or selects inside header
                        if (e.target.tagName === 'BUTTON' || 
                            e.target.tagName === 'SELECT' || 
                            e.target.tagName === 'INPUT' ||
                            e.target.closest('button')) {
                            return;
                        }
                        
                        content.classList.toggle('collapsed');
                        collapseBtn.textContent = content.classList.contains('collapsed') ? '+' : 'âˆ’';
                        
                        // If expanded, remove any max-width constraints
                        if (!content.classList.contains('collapsed')) {
                            card.style.gridColumn = 'span var(--grid-span, 1)';
                        }
                    });
                    
                    // Collapse button click
                    collapseBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        content.classList.toggle('collapsed');
                        collapseBtn.textContent = content.classList.contains('collapsed') ? '+' : 'âˆ’';
                    });
                }
            });
            
            // Expand All button
            document.getElementById('expandAllBtn')?.addEventListener('click', () => {
                cards.forEach(card => {
                    const content = card.querySelector('.card-content');
                    const collapseBtn = card.querySelector('.collapse-btn');
                    if (content && collapseBtn) {
                        content.classList.remove('collapsed');
                        collapseBtn.textContent = 'âˆ’';
                    }
                });
            });
            
            // Collapse All button
            document.getElementById('collapseAllBtn')?.addEventListener('click', () => {
                cards.forEach(card => {
                    const content = card.querySelector('.card-content');
                    const collapseBtn = card.querySelector('.collapse-btn');
                    if (content && collapseBtn) {
                        content.classList.add('collapsed');
                        collapseBtn.textContent = '+';
                    }
                });
            });
        });
    </script>
</body>
</html>